<?php if(!$this->displayDuplicates) : ?>
    <?php $this->placeholder('headling_1')->captureStart();?>
    <div class="ui-button-big ui-button-back" id="bidule">
        <a href="<?php echo $this->url(array('duplicates'=>null));?>" class="ui-button ui-button-bg-white ui-button-text-red ui-button-text-only">
            <span class="ui-button-text"><?php echo $this->translate('Back')?></span>
        </a>
    </div>
    <?php $this->placeholder('headling_1')->captureEnd();?>
<?php endif ?>
<div class="grid medias grid-sortable">
    <div class="row row-template">
        <div class="col col-picture"></div>
        <div class="col col-title"></div>
        <div class="col col-infos"></div>
        <div class="col col-actions"></div>
    </div>

    <?php foreach ($this->result as $id => $row):
    if (isset($this->coverName)) :
        $cover = $row['row']->{'get'.$this->coverName.'OrPx'}();
    else :
        $cover = $row['row'];
    endif;

    if (isset($this->popup)) :
        $editUrl = 'javascript:mySubmit(\'' . $this->serverUrl($cover->getStaticUrl()) . '\', \''.$this->escape($cover->filename).'\', \'\')';
    else :
        $editUrl = $this->url(array('id' => $row['row']->id, 'action' => 'get', 'saving' => null));
    endif;

    $infos = isset($row['infos']) ? $row['infos'] : null;  
    
    ?>
        <div class="row">
            <div class="col col-picture" title="<?php echo $row['row']->filename ?>">
                <?php if($this->popup) : ?>
                <a href="<?php echo $editUrl ?>">
                <?php endif ?>
                <div style="background: url('<?php echo $this->escape($cover->getStaticUrl(array('cropcenterresize' => array('width' => 174, 'height' => 94))))?>'); width: 174px; height: 94px;" class="picture">
                </div>
                <?php if($this->popup) : ?>
                </a>
                <?php endif ?>
            </div>
            <div class="col col-title">
                <?php if(!$this->popup) : ?>
                    <?php if(!$this->displayDuplicates || !isset($row['duplicates']) || $row['duplicates'] < 2) : ?>
                    <input type="checkbox" value="<?php echo $id;?>" name="rowId[]">
                    <?php endif ?>
                <?php endif ?>
                <a href="<?php echo $editUrl;?>" class="edit" title="<?php echo $this->escape($row['row']->filename) ?>"><?php echo $this->smartTextCrop($row['row']->filename, 20, true) ?></a>
            </div>
            <?php if($infos): ?>
            <div class="col col-infos">
                <?php if($this->displayDuplicates && isset($row['duplicates']) && $row['duplicates'] > 1) : ?>
                    <a href="<?php echo $this->url(array('duplicates'=>$row['sha1'], 'page'=>null)) ?>"><?php echo $this->translate('%s duplicates', $row['duplicates']) ?></a>
                <?php else : ?>
                    <?php echo $row['infos'] ?>
                <?php endif ?>
            </div>
            <?php endif; //infos ?>
            <?php if(!$this->displayDuplicates || !isset($row['duplicates']) || $row['duplicates'] < 2) : ?>
                <div class="col col-actions">
                <?php
                    $this->row = $row['row'];
                    echo $this->partial($this->_selectScript(array(sprintf('%s/_actions.phtml', $this->controller),
                                             'grid/_actions.phtml')), $this); ?>
                </div>
            <?php endif ?>
        </div>
    <?php endforeach; ?>
    <div class="clear"></div>
</div>

